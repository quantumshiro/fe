---
source: crates/codegen/tests/yul.rs
expression: output
input_file: tests/fixtures/storage_map_contract.fe
---
object "BalanceMap" {
  code {
    function init() {
      let v0 := datasize("BalanceMap_deployed")
      let v1 := dataoffset("BalanceMap_deployed")
      codecopy(0, v1, v0)
      return(0, v0)
    }
    init()
  }

  object "BalanceMap_deployed" {
    code {
      function abi_encode(value) {
        let v0 := 0
        mstore(v0, value)
        return(v0, 32)
      }
      function get_allowance(addr, allowances) -> ret {
        let v0 := storagemap_k__v__get_stor__u256_u256__cc308d1bea3fb6e4(allowances, addr)
        ret := v0
        leave
      }
      function get_balance(addr, balances) -> ret {
        let v0 := storagemap_k__v__get_stor__u256_u256__cc308d1bea3fb6e4(balances, addr)
        ret := v0
        leave
      }
      function runtime() {
        let v0 := 0
        let v1 := 1
        let v2 := calldataload(0)
        let v3 := shr(224, v2)
        switch v3
          case 2630350600 {
            let v4 := calldataload(4)
            let v5 := v0
            let v6 := get_balance(v4, v5)
            let v7 := v6
            abi_encode(v7)
          }
          case 1246470123 {
            let v8 := calldataload(4)
            let v9 := calldataload(36)
            let v10 := v0
            set_balance(v8, v9, v10)
            abi_encode(0)
          }
          case 2430412327 {
            let v11 := calldataload(4)
            let v12 := calldataload(36)
            let v13 := calldataload(68)
            let v14 := v0
            let v15 := transfer(v11, v12, v13, v14)
            let v16 := v15
            abi_encode(v16)
          }
          case 3378517838 {
            let v17 := calldataload(4)
            let v18 := v1
            let v19 := get_allowance(v17, v18)
            let v20 := v19
            abi_encode(v20)
          }
          case 197806145 {
            let v21 := calldataload(4)
            let v22 := calldataload(36)
            let v23 := v1
            set_allowance(v21, v22, v23)
            abi_encode(0)
          }
          default {
            return(0, 0)
          }
        leave
      }
      function set_allowance(addr, value, allowances) {
        storagemap_k__v__set_stor__u256_u256__cc308d1bea3fb6e4(allowances, addr, value)
        leave
      }
      function set_balance(addr, value, balances) {
        storagemap_k__v__set_stor__u256_u256__cc308d1bea3fb6e4(balances, addr, value)
        leave
      }
      function storagemap_k__v__get_stor__u256_u256__cc308d1bea3fb6e4(self, key) -> ret {
        let v0 := storagemap_k__v__storage_slot_stor__u256_u256__cc308d1bea3fb6e4(self, key)
        let v1 := sload(v0)
        let v2 := u256_loadablescalar_from_word(v1)
        ret := v2
        leave
      }
      function storagemap_k__v__set_stor__u256_u256__cc308d1bea3fb6e4(self, key, value) {
        let v0 := storagemap_k__v__storage_slot_stor__u256_u256__cc308d1bea3fb6e4(self, key)
        let v1 := u256_loadablescalar_from_word(value)
        sstore(v0, v1)
        leave
      }
      function storagemap_k__v__storage_slot_stor__u256_u256__cc308d1bea3fb6e4(self, key) -> ret {
        let v0 := u256_storagekey_write_key(0, key)
        let v1 := self
        mstore(v0, v1)
        let v2 := keccak256(0, add(v0, 32))
        ret := v2
        leave
      }
      function transfer(from, to, amount, balances) -> ret {
        let v0 := storagemap_k__v__get_stor__u256_u256__cc308d1bea3fb6e4(balances, from)
        let v1 := lt(v0, amount)
        if v1 {
          ret := 1
          leave
        }
        if iszero(v1) {
          let v2 := storagemap_k__v__get_stor__u256_u256__cc308d1bea3fb6e4(balances, to)
          storagemap_k__v__set_stor__u256_u256__cc308d1bea3fb6e4(balances, from, sub(v0, amount))
          storagemap_k__v__set_stor__u256_u256__cc308d1bea3fb6e4(balances, to, add(v2, amount))
          ret := 0
          leave
        }
      }
      function u256_loadablescalar_from_word(word) -> ret {
        ret := word
        leave
      }
      function u256_storagekey_write_key(ptr, self) -> ret {
        mstore(ptr, self)
        ret := 32
        leave
      }
      runtime()
      return(0, 0)
    }
  }
}
