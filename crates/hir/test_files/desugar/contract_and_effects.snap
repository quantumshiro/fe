---
source: crates/hir/tests/desugar.rs
expression: output
input_file: test_files/desugar/contract_and_effects.fe
---
use core::prelude::*

mod __Counter {
    use super::*
    use core::effect_ref::StorPtr
    use core::intrinsic::contract_field_slot
    use core::abi::prefix
    use core::abi::decode_or_revert
    use core::codecopy
    use core::code_region_len
    use core::code_region_offset
    use core::return_data
    use core::revert
    use core::Result
    use std::evm::calldata::CallData
    use std::abi::Sol
    use std::abi::sol::SolDecoder
    use std::abi::sol::SolEncoder

    fn recv_0_0(args: CounterMsg::Increment::Args) uses (mut count: u64) {
        return {
            count += 1
        }
    }

    fn recv_0_1(args: CounterMsg::Get::Args) -> u64 uses (count: u64) {
        return {
            count
        }
    }

    #[contract_init(Counter)]
    fn init() {
        let __len = code_region_len(runtime)
        let __offset = code_region_offset(runtime)
        codecopy(dest: 0, __offset, __len)
        return_data(0, __len)
    }

    #[contract_runtime(Counter)]
    fn runtime() {
        let mut count = StorPtr<u64>::at_offset(contract_field_slot(0))
        let __calldata = CallData {  }
        let __prefix = prefix(__calldata)
        let __selector = Sol::selector_from_prefix(__prefix.word0)
        if __selector == CounterMsg::Increment::SELECTOR {
            let mut __d = SolDecoder<CallData>::with_base(__calldata, 4)
            let __args: CounterMsg::Increment::Args = decode_or_revert<Sol, CounterMsg::Increment::Args, SolDecoder<CallData>>(__d)
            with (count) { recv_0_0(__args) }
            return_data(0, 0)
        } else if __selector == CounterMsg::Get::SELECTOR {
            let mut __d = SolDecoder<CallData>::with_base(__calldata, 4)
            let __args: CounterMsg::Get::Args = decode_or_revert<Sol, CounterMsg::Get::Args, SolDecoder<CallData>>(__d)
            let __result = with (count) { recv_0_1(__args) }
            let mut __enc = SolEncoder::new()
            match __enc.reserve_head(32) {
                Result::Ok(_) => (),
                Result::Err(_) => revert(0, 0),
            }
            match __result.encode(__enc) {
                Result::Ok(_) => (),
                Result::Err(_) => revert(0, 0),
            }
            match __enc.finish() {
                Result::Ok((__ptr, __out_len)) => return_data(__ptr, __out_len),
                Result::Err(_) => revert(0, 0),
            }
        } else { revert(0, 0) }
    }
}

mod CounterMsg {
    use core::prelude::*
    use super::*

    pub struct Increment {}

    impl core::message::MsgVariant<std::abi::Sol> for Increment {
        type Args = ()
        type Return = ()
        const SELECTOR: u32 = 1
    }

    impl Increment {
        pub fn decode(mut _ d: std::abi::sol::SolDecoder<std::evm::calldata::CallData>) -> Self {
            return Self {  }
        }
    
    }

    pub struct Get {}

    impl core::message::MsgVariant<std::abi::Sol> for Get {
        type Args = ()
        type Return = u64
        const SELECTOR: u32 = 2
    }

    impl Get {
        pub fn decode(mut _ d: std::abi::sol::SolDecoder<std::evm::calldata::CallData>) -> Self {
            return Self {  }
        }
    
    }
}

pub struct Storage {
    pub value: u256,
}

fn use_storage() uses (mut Storage) {
    Storage.value = 100
}
